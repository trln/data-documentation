* Overview
*HERE YOU WILL FIND* details on how MARC bibliographic fields and subfields are mapped into Endeca, for initial Argot/Argon data model analysis and decisionmaking

This is all based on [[http://archive.trln.org/endeca/private/data-model/TRLN-Endeca-Mappings.xls][TRLN Endeca data model spreadsheet]] (with its known incompleteness/inaccuracies), and other data detailed in the [[https://github.com/trln/data-documentation/tree/master/marc][MARC]] and [[https://github.com/trln/data-documentation/tree/master/endeca][Endeca]] folders in this repository.

*MOST IMPORTANT THING*
 - The .tsv (tab separated values) files beginning with '_' are for reference only
 - These files are generated by [[https://github.com/trln/data-documentation/blob/master/marc_to_endeca/marc_map_list_gen.rb][a script]], based on [[https://github.com/trln/data-documentation/tree/master/marc][information about the MARC standard from LC]], combined with master list of [[https://github.com/trln/data-documentation/blob/master/marc_to_endeca/marc_to_endeca.tsv][MARC field/subfield -> Endeca mappings]]
 - If one of the files beginning with '_' is inaccurate:
   - Correct the information in [[https://github.com/trln/data-documentation/blob/master/marc_to_endeca/marc_to_endeca.tsv][marc_to_endeca.tsv]] 
   - Re-run [[https://github.com/trln/data-documentation/blob/master/marc_to_endeca/marc_map_list_gen.rb][marc_map_list_gen.rb]]
   - Data in the output files will be corrected

See below for details on what each file contains and conventions followed in the files. 

* Input/data source files *(manually editable, with caveats)*
*WARNINGS*
 - You must make sure you have the latest version of the file before editing
 - You must commit your changes after editing
 - Scripts using the edited file(s) as input should be re-run and their results committed
 - *YOU MUST FOLLOW THE FORMAT/CONVENTIONS EXACTLY WHEN EDITING* -- otherwise scripts will break and all data cascading from here will be trash
** marc_to_endeca.tsv
 - Mappings from MARC to Endeca elements (i.e. properties/dimensions).
 - Initially derived from [[http://archive.trln.org/endeca/private/data-model/TRLN-Endeca-Mappings.xls][TRLN Endeca data model spreadsheet]]
 - Modified and expected to continue to change
*** Data dictionary
**** Endeca Element
 - The name of the Endeca property or dimension to which MARC data is mapped
 - Name is taken from the internal Endeca configs, not spreadsheet
 - Refer to /Element name/ column in [[https://github.com/trln/data-documentation/blob/master/endeca/_endeca_final_elements_compiled.tsv][_endeca_final_elements_compiled.tsv]] for full list of elements. Be *very* careful about spaces, underscores, typos. 
**** MARC tag
 - MARC field tag that is mapped to Endeca
**** ind1
 - 1st indicator values required for field to be mapped
 - Conventions defined in /Ind 1/ section of https://github.com/trln/data-documentation/blob/master/marc_to_argot/transform_instructions.org

**** ind2
 - 2nd indicator values required for field to be mapped
 - Conventions defined in /Ind 2/ section of https://github.com/trln/data-documentation/blob/master/marc_to_argot/transform_instructions.org

**** MARC Further constraint
 - Other requirements for field to be mapped
 - Conventions defined in /FieldConstraint/ section of https://github.com/trln/data-documentation/blob/master/marc_to_argot/transform_instructions.org
 - If constraint cannot be succinctly and clearly expressed following those conventions, enter a text string that will make sense if interpolated in the following phrase:
   - When $string, field XXX is mapped to Endeca Element

**** MARC Subfields
 - subfields included in the mapping
 - Conventions defined in /Subfield/ section of https://github.com/trln/data-documentation/blob/master/marc_to_argot/transform_instructions.org

**** INST
 - Institution to which mapping rule applies
 - If TRLN, rule is taken from Endeca data model spreadsheet, where there were no notes about varying institutional practices
 - If TRLN-, rule is taken from Endeca data model spreadsheet, where there were no notes about varying institutional practices, BUT there is at least one other institution-specific rule in the file that is different than the TRLN spreadsheet rule

* Result/reference files *(DO NOT EDIT MANUALLY)*
** _marc_bib_tags_mapped_exploded.tsv
 - Lists every MARC tag defined in the current standard, plus obsolete fields
 - Specifies whether data from the tag is mapped into Endeca or not
 - Where data from a tag is mapped a) to multiple elements; b) according to different constraints; or c) differently per institution, THEN one row is output for each mapping rule

This affords: 
 - Answering: "Is this MARC tag in Endeca?" (and mashing this up with other data to say whether and how it's indexed)
 - Identifying unmapped MARC fields for decisionmaking about future mapping
** _marc_bib_tags_mapped_summary.tsv
 - Lists every MARC tag defined in the current standard, plus obsolete fields
 - Specifies whether data from the tag is mapped into Endeca or not
 - One row per MARC tag, regardless of how many mapping rules apply. All mappings are summarized in /Endeca mappings/ column.
   - Multiple mappings are separated by: ;;;
   - Each mapping is prefaced by the relevant institution in parentheses
   - This in the row for 024:
     - (TRLN): a -> ISBN;;;(TRLN): WHEN i1=1, a -> UPC
   - Would be read as:
     - According to TRLN data model spreadsheet, 024$a is always mapped to ISBN
     - According to TRLN data model spreadsheet, 024$a is mapped to UPC when 1st indicator is 1
This affords: 
 - A more compact view for identifying unmapped MARC fields for decisionmaking about future mapping
** _marc_bib_sfs_mapped.tsv
 - One row per mapping rule per MARC subfield mapped into Endeca
** _marc_bib_sfs_UNmapped.tsv
 - Lists defined MARC subfields that are NOT mapped into Endeca
 - Omits subfields from fields that are not mapped into Endeca at all
* Scripts
** marc_map_list_gen.rb
 - Mashes up the .tsv files in [[https://github.com/trln/data-documentation/tree/master/marc][data-documentation/marc/] (re:current MARC standard) with marc_to_endeca.tsv (re:our mappings)
 - Produces all result/reference files beginning with _ in this directory

Usage: ruby marc_map_list_gen.rb
